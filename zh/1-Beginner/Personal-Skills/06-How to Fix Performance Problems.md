# 如何修復效能問題
[//]: # (Version:1.0.0)
大部分軟體都可以通過付出相對較小的努力，讓他們比剛釋出時快上10到100倍。在市場的壓力下，選擇一個簡單而快速的解決問題的方法是比選擇其它方法更為明智而有效率的選擇。然而，效能是可用性的一部分，而且通常它也需要被更仔細地考慮。

提高一個非常複雜的系統的效能的關鍵是，充分分析它，來發現其“瓶頸”，或者其資源耗費的地方。優化一個只佔用1%執行時間的函數是沒有多大意義的。一個簡要的原則是，你在做任何事情之前必須仔細思考，除非你認為它能夠使系統或者它的一個重要部分至少快兩倍。通常會有一種方法來達到這個效果。考慮你的修改會帶來的測試以及質量保證的工作需要。每個修改帶來一個測試負擔，所以最好這個修改能帶來一點大的優化。

當你在某個方面做了一個兩倍提升後，你需要至少重新考慮並且可能重新分析，去發現系統中下一個最昂貴的瓶頸，並且攻破那個瓶頸，得到下一個兩倍提升。

通常，效能的瓶頸的一個例子是，數牛的數目：通過數腳的數量然後除以4，還是數頭的數量。舉些例子，我曾犯過的一些錯誤：沒能在關聯式資料庫中，為我經常查詢的那一列提供適當的索引，這可能會使得它至少慢了20倍。其他例子還包括在迴圈裡做不必要的 I/O 操作，留下不再需要的偵錯語句，不再需要的記憶體分配，還有，尤其是，不專業地使用庫和其他的沒有為效能充分編寫過的子系統。這種提升有時候被叫做“低垂的水果”，意思是它可以被輕易地獲取，然後產生巨大的好處。

你在用完這些“低垂的水果”之後，應該做些什麼呢？你可以爬高一點，或者把樹鋸倒。你可以繼續做小的改進或者你可以嚴肅地重構整個系統或者一個子系統。（不只是在新的設計裡，在信任你的 boss 這方面，作為一個好的程式設計師，這是一個非常好的使用你的技能的機會）然而，在你考慮重構子系統之前，你應該問你自己，你的建議是否會讓它好五倍到十倍。

Next [如何優化迴圈](07-How to Optimize Loops.md)
